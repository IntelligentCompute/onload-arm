# SPDX-License-Identifier: GPL-2.0
# X-SPDX-Copyright-Text: (c) Copyright 2010-2019 Xilinx, Inc.

# This file is part of OpenOnload(tm).
#
# ARM64-specific modprobe configuration for kernel 6.8+
# This configuration handles the syscall table detection issue on modern ARM64 kernels
#
# We recommend you do not edit this file.  To add custom module options
# create a new file in /etc/modprobe.d/.
#

# Use the ARM64 helper script that handles syscall table detection and module loading order
install onload /usr/sbin/onload_arm64_helper && \
               /sbin/modprobe --ignore-install onload $CMDLINE_OPTS \
                 $(/sbin/onload_tool mod_params onload)

install sfc /sbin/modprobe --ignore-install sfc $CMDLINE_OPTS && \
            if [ -e /lib/modules/$(uname -r)/extra/sfc_aoe.ko ]; then \
              /sbin/modprobe sfc_aoe; \
            fi